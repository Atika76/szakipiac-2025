<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Hirdetés feltöltés</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="logo.png">
  <link rel="stylesheet" href="style.css">
  <style>
    #image-previews { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; border: 1px solid #eee; padding: 10px; min-height: 50px; border-radius: 5px; }
    .preview-image-container { position: relative; }
    .preview-image { width: 80px; height: 80px; object-fit: cover; border-radius: 5px; }
    .remove-image-btn { position: absolute; top: -5px; right: -5px; background: red; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-weight: bold; line-height: 20px; text-align: center; }
  </style>
</head>
<body>
  <header class="green-header">
    <img src="logo.png" class="logo" alt="SzakiPiac logó">
    <nav>
      <a href="index.html">Főoldal</a>
      <a href="rolunk.html">Rólunk</a>
      <a href="kapcsolat.html">Kapcsolat</a>
      <a href="feltoltes.html" style="font-weight:bold;">Hirdetés feltöltés</a>
      <a href="auth.html">Bejelentkezés</a>
    </nav>
  </header>
  <div class="container">
    <div class="content-box">
      <h1>Hirdetés feltöltés</h1>
      <form id="feltoltesForm">
        <label>Képek feltöltése (egyenként is hozzáadhatod):</label>
        <input type="file" id="kepek" accept="image/jpeg, image/png">
        <div id="image-previews"></div>
        <button type="submit">Hirdetés feladása</button>
      </form>
      <div id="uzenet" style="margin-top:16px; font-weight: bold;"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=..."></script>
  <script src="supabase.js"></script>
  <script src="header.js"></script>
  <script>
    const feltoltesForm = document.getElementById('feltoltesForm');
    const uzenetDiv = document.getElementById('uzenet');
    const kepekInput = document.getElementById('kepek');
    const previewsContainer = document.getElementById('image-previews');
    const csomagValaszto = document.getElementById("csomagValaszto");

    let kivalasztottKepek = []; // Ideiglenes tároló a képeknek
    const packageLimits = { 'Alap': 2, 'Prémium': 3, 'Extra': 5 };

    function renderPreviews() {
        previewsContainer.innerHTML = '';
        kivalasztottKepek.forEach((file, index) => {
            const container = document.createElement('div');
            container.className = 'preview-image-container';
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            img.className = 'preview-image';
            
            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'X';
            removeBtn.className = 'remove-image-btn';
            removeBtn.type = 'button'; // Fontos, hogy ne küldje el az űrlapot
            removeBtn.onclick = () => {
                kivalasztottKepek.splice(index, 1); // Kép eltávolítása a tárolóból
                renderPreviews(); // Előnézetek újrarajzolása
            };
            
            container.appendChild(img);
            container.appendChild(removeBtn);
            previewsContainer.appendChild(container);
        });
    }

    kepekInput.addEventListener('change', () => {
        const limit = packageLimits[csomagValaszto.value];
        const file = kepekInput.files[0];

        if (kivalasztottKepek.length >= limit) {
            alert(`Már elérted a maximum (${limit} db) feltölthető kép számát.`);
            kepekInput.value = '';
            return;
        }

        if (file) {
            kivalasztottKepek.push(file);
            renderPreviews();
        }
        kepekInput.value = ''; // A fájlválasztó kiürítése, hogy újra lehessen választani
    });

    csomagValaszto.addEventListener('change', () => {
        kivalasztottKepek = []; // Csomagváltáskor töröljük a képeket
        renderPreviews();
    });

    feltoltesForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        // ... A meglévő feltöltési logika, de a `kepekInput.files` helyett
        // a `kivalasztottKepek` tömböt használja a képfeltöltéshez ...
        
        try {
            const imageUrls = [];
            for (const file of kivalasztottKepek) {
                // ... feltöltés a Supabase Storage-be ...
                // const { data: { publicUrl } } = ...;
                // imageUrls.push(publicUrl);
            }

            // ... hirdetés adatainak mentése az adatbázisba az imageUrls tömbbel ...
            
            uzenetDiv.textContent = "Sikeres feltöltés!";
        } catch (error) {
            uzenetDiv.textContent = "Hiba: " + error.message;
        }
    });
  </script>
</body>
</html>
