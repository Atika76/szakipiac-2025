!DOCTYPE html
html lang=hu
head
    meta charset=UTF-8
    meta name=viewport content=width=device-width, initial-scale=1.0
    titleSzakiPiac-2025.hu - Találj megbízható szakembert!title

    link rel=icon type=imagepng sizes=32x32 href=httpsraw.githubusercontent.comAtika76szakipiac-2025mainlogo.png
    link rel=icon type=imagepng sizes=16x16 href=httpsraw.githubusercontent.comAtika76szakipiac-2025mainlogo.png
    link rel=apple-touch-icon sizes=180x180 href=httpsraw.githubusercontent.comAtika76szakipiac-2025mainlogo.png
    link rel=shortcut icon href=httpsraw.githubusercontent.comAtika76szakipiac-2025mainlogo.png
    script src=httpscdn.tailwindcss.comscript
    link rel=preconnect href=httpsfonts.googleapis.com
    link rel=preconnect href=httpsfonts.gstatic.com crossorigin
    link href=httpsfonts.googleapis.comcss2family=Interwght@400;500;600;700&display=swap rel=stylesheet
    
    script src=httpscdn.jsdelivr.netnpm@supabasesupabase-js@2script
    script src=httpswww.paypal.comsdkjsclient-id=AQsaQCLj0og2wsfMoDKAqxJieD2cgXwWq5cssAJCJbO2KoYE8LGHCREyR4vMzMfKZK68qw6EY7IAxMYF&currency=HUFscript

    style
        body { font-family 'Inter', sans-serif; background-color #f7fafc; }
        .page-content { display none; }
        .loader, .gemini-loader { border-radius 50%; animation spin 1s linear infinite; }
        .loader { border 4px solid #f3f3f3; border-top 4px solid #2d3748; width 40px; height 40px; }
        .gemini-loader { border 2px solid #f3f3f3; border-top 2px solid #4f46e5; width 16px; height 16px; }
        @keyframes spin { 0% { transform rotate(0deg); } 100% { transform rotate(360deg); } }
        .lightbox { transition opacity 0.3s ease; }
    style
head
body class=bg-gray-50 text-gray-800

    header class=bg-white shadow-md sticky top-0 z-50
        nav class=container mx-auto px-4 smpx-6 lgpx-8
            div class=flex items-center justify-between h-16
                div class=flex items-center
                    a href=#home class=nav-link-logo flex-shrink-0 flex items-center gap-2 text-xl font-bold text-gray-800
                        img class=h-8 w-auto src=httpsraw.githubusercontent.comAtika76szakipiac-2025mainszakipiac-logo-promo.png alt=SzakiPiac logó
                        spanSzakiPiac-2025.huspan
                    a
                div
                div class=hidden mdflex items-center space-x-1
                    a href=#home class=nav-link text-gray-600 hoverbg-gray-100 px-3 py-2 rounded-md text-sm font-mediumFőoldala
                    a href=#rolunk class=nav-link text-gray-600 hoverbg-gray-100 px-3 py-2 rounded-md text-sm font-mediumRólunka
                    a href=#kapcsolat class=nav-link text-gray-600 hoverbg-gray-100 px-3 py-2 rounded-md text-sm font-mediumKapcsolata
                    a href=#feltoltes class=nav-link bg-green-600 text-white hoverbg-green-700 px-3 py-2 rounded-md text-sm font-mediumHirdetés feltöltésea
                div
                div id=nav-auth-section class=hidden mdblockdiv
                div class=mdhidden
                    button id=mobile-menu-button class=inline-flex items-center justify-center p-2 rounded-md text-gray-400svg class=h-6 w-6 xmlns=httpwww.w3.org2000svg fill=none viewBox=0 0 24 24 stroke=currentColorpath stroke-linecap=round stroke-linejoin=round stroke-width=2 d=M4 6h16M4 12h16m-7 6h7 svgbutton
                div
            div
            div id=mobile-menu class=mdhidden hidden
                div class=px-2 pt-2 pb-3 space-y-1 smpx-3
                    a href=#home class=nav-link text-gray-600 hoverbg-gray-100 block px-3 py-2 rounded-md text-base font-mediumFőoldala
                    a href=#rolunk class=nav-link text-gray-600 hoverbg-gray-100 block px-3 py-2 rounded-md text-base font-mediumRólunka
                    a href=#kapcsolat class=nav-link text-gray-600 hoverbg-gray-100 block px-3 py-2 rounded-md text-base font-mediumKapcsolata
                    a href=#feltoltes class=nav-link bg-green-600 text-white block px-3 py-2 rounded-md text-base font-mediumHirdetés feltöltésea
                    div id=mobile-nav-auth-section class=pt-4 mt-4 border-t border-gray-200div
                div
            div
        nav
    header

    main class=container mx-auto px-4 smpx-6 lgpx-8 py-8
        
        div id=main-loader class=page-content flex justify-center items-center py-20 style=display none;
            div class=loaderdiv
        div

        div class=grid grid-cols-1 lggrid-cols-3 gap-8
            div class=lgcol-span-2
                div id=home-page class=page-contentdiv
                div id=rolunk-page class=page-contentdiv
                div id=kapcsolat-page class=page-contentdiv
                div id=feltoltes-page class=page-contentdiv
                div id=auth-page class=page-contentdiv
                div id=admin-page class=page-contentdiv
            div
            aside class=hidden lgblock space-y-6
              div class=bg-white p-6 rounded-lg shadow-sm
                h3 class=text-lg font-semibold text-gray-800 mb-4 text-centerPartnereink és ajánlatainkh3
                div id=reklam-slider class=relative overflow-hidden rounded-lg shadow-md style=height 260px;
                  div id=reklam-slidesdiv
                  div id=reklam-dots class=absolute bottom-2 left-12 -translate-x-12 flex gap-2div
                  button id=slider-prev class=absolute top-12 left-2 -translate-y-12 bg-white bg-opacity-80 p-2 rounded-full shadow hoverbg-opacity-100 z-10
                    svg class=w-6 h-6 text-gray-800 fill=none stroke=currentColor stroke-width=2 viewBox=0 0 24 24path d=M15 19l-7-7 7-7pathsvg
                  button
                  button id=slider-next class=absolute top-12 right-2 -translate-y-12 bg-white bg-opacity-80 p-2 rounded-full shadow hoverbg-opacity-100 z-10
                    svg class=w-6 h-6 text-gray-800 fill=none stroke=currentColor stroke-width=2 viewBox=0 0 24 24path d=M9 5l7 7-7 7pathsvg
                  button
                div
              div
            aside
        div
    main
    
    div id=lightbox class=fixed inset-0 bg-black bg-opacity-75 z-[100] hidden items-center justify-center opacity-0 lightboxspan id=lightbox-close class=absolute top-4 right-6 text-white text-5xl font-bold cursor-pointer hovertext-gray-300&times;spanimg id=lightbox-img class=max-w-[90%] max-h-[85%] rounded-lgdiv
    div id=toast-notification class=fixed top-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg transform translate-x-[120%] transition-transform duration-300 z-[110]div

script
 ===== Reklám slider kibővítve a kért partnerekkel =====
const reklamok = [
     1. SAJÁT HIRDETÉS
    { 
      url #feltoltes, 
      img httpsraw.githubusercontent.comAtika76szakipiac-2025mainszakipiac-reklam.png, 
      alt Hirdess a SzakiPiac-2025 oldalon! 
    },
     2. SAJÁT HIRDETÉS
    { 
      url #feltoltes, 
      img httpsraw.githubusercontent.comAtika76szakipiac-2025mainszakipiac-logo-promo.png, 
      alt SzakiPiac-2025 Hirdess, találj, dolgozz! 
    },
     3. PARTNER HIRDETÉS - FONTOS Ezt cseréld le a saját affiliate linkedre!
    { 
      url httpswww.alza.hu, 
      img httpsupload.wikimedia.orgwikipediacommons11fAlza.cz_logo.svg, 
      alt Alza.hu – Vásárolj online! 
    },
     4. PARTNER HIRDETÉS - FONTOS Ezt cseréld le a saját affiliate linkedre!
    { 
      url httpswww.emag.hu, 
      img httpsupload.wikimedia.orgwikipediacommonsaafLogo_eMAG_%282019%29.svg, 
      alt eMAG – Óriási választék! 
    },
     5. PARTNER HIRDETÉS - FONTOS Ezt cseréld le a saját affiliate linkedre!
    { 
      url httpswww.temu.com, 
      img httpsupload.wikimedia.orgwikipediacommonsddbTemu_logo_icon.svg, 
      alt Temu 
    },
     6. PARTNER HIRDETÉS - FONTOS Ezt cseréld le a saját affiliate linkedre!
    {
      url httpswww.lidl.hu,
      img httpsupload.wikimedia.orgwikipediacommonsthumb991Lidl-Logo.svg1200px-Lidl-Logo.svg.png,
      alt Lidl
    },
     7. PARTNER HIRDETÉS - FONTOS Ezt cseréld le a saját affiliate linkedre!
    {
      url httpswww.aldi.hu,
      img httpsupload.wikimedia.orgwikipediacommonsthumbaa6Aldi_S%C3%BCd_logo.svg1200px-Aldi_S%C3%BCd_logo.svg.png,
      alt Aldi
    }
];

let reklamIndex = 0, reklamTimer = null;

function renderReklamSlide(index) {
  const slides = document.getElementById(reklam-slides);
  if (!slides  !reklamok.length) return;
  const ad = reklamok[index];
  const linkClass = ad.url.startsWith('#')  'nav-link'  '';
  slides.innerHTML = `
    a href=${ad.url} class=${linkClass} block w-full h-[250px] transition-all duration-500 ${!linkClass  'target=_blank rel=noopener sponsored'  ''}
      img src=${ad.img} alt=${ad.alt  ''} class=w-full h-full object-contain p-2 bg-white rounded-md shadow draggable=false
    a
  `;
  const dots = document.getElementById(reklam-dots);
  if (dots) {
    dots.innerHTML = reklamok.map((_, i) = 
      `button class=w-3 h-3 rounded-full border-2 ${i===index'bg-green-600 border-green-700''bg-white border-gray-400'} onclick=showReklamSlide(${i}) aria-label=Reklám ${i+1}button`
    ).join('');
  }
}

function showReklamSlide(index) {
  reklamIndex = index;
  renderReklamSlide(reklamIndex);
  resetReklamTimer();
}

function reklamPrev() {
  reklamIndex = (reklamIndex - 1 + reklamok.length) % reklamok.length;
  renderReklamSlide(reklamIndex);
  resetReklamTimer();
}

function reklamNext() {
  reklamIndex = (reklamIndex + 1) % reklamok.length;
  renderReklamSlide(reklamIndex);
  resetReklamTimer();
}

function resetReklamTimer() {
  if (reklamTimer) clearInterval(reklamTimer);
  if (reklamok.length  1) {
    reklamTimer = setInterval(() = reklamNext(), 4000); 
  }
}

document.addEventListener(DOMContentLoaded, () = {
  if (document.getElementById(reklam-slider)) {
    renderReklamSlide(reklamIndex);
    const prev = document.getElementById(slider-prev);
    const next = document.getElementById(slider-next);
    if (prev) prev.addEventListener(click, reklamPrev);
    if (next) next.addEventListener(click, reklamNext);
    resetReklamTimer();
  }
});

window.showReklamSlide = showReklamSlide;

 ===== KONFIGURÁCIÓ =====
const SUPABASE_URL = httpsbxtpnotswnwrbycvfypz.supabase.co;
const SUPABASE_KEY = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ4dHBub3Rzd253cmJ5Y3ZmeXB6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTQ0NDcsImV4cCI6MjA2ODQ5MDQ0N30.CXEfo_8qmIYhkEZFdTsbl9ZB-PRTP6UK8EbIxxpSGZc;
const supaClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const ADMIN_EMAIL = atika.76@windowslive.com;

 ===== GLOBÁLIS VÁLTOZÓK =====
let kivalasztottKepek = [];
let hirdetesekCache = [];

 ===== ROUTER ÉS FŐ LOGIKA =====
const router = {
    '#home' showHomePage, '#rolunk' showRolunkPage, '#kapcsolat' showKapcsolatPage,
    '#feltoltes' showFeltoltesPage, '#auth' showAuthPage, '#admin' showAdminPage
};

function showPage(pageId) {
    document.querySelectorAll('.page-content').forEach(p = {
        if (p.id !== 'main-loader') {
            p.style.display = 'none';
        }
    });
    const activePage = document.getElementById(pageId + '-page');
    if (activePage) activePage.style.display = 'block';
}

async function handleRouteChange() {
    const hash = window.location.hash  '#home';
    
    document.querySelectorAll('.page-content').forEach(p = p.style.display = 'none');
    const mainLoader = document.getElementById('main-loader');
    if (mainLoader) mainLoader.style.display = 'flex';

    const routeHandler = router[hash]  router['#home'];
    try {
        await routeHandler(); 
        
        if (mainLoader) mainLoader.style.display = 'none';
        showPage(hash.substring(1));

    } catch (err) {
        console.error(`Hiba az oldal betöltésekor (${hash})`, err);
        if (mainLoader) mainLoader.style.display = 'none';
    }
    
    document.querySelectorAll('.nav-link').forEach(link = {
        link.classList.toggle('bg-gray-100', link.getAttribute('href') === hash);
    });
    document.getElementById('mobile-menu').classList.add('hidden');
}

 ===== OLDALAK MEGJELENÍTÉSE =====
async function showHomePage() {
    const container = document.getElementById('home-page');
    container.innerHTML = `
        div class=text-center mb-8
            h1 class=text-4xl font-boldÜdvözlünk a span class=text-green-600SzakiPiac-2025.huspan-n!h1
            p class=mt-3 text-lg text-gray-500Találj megbízható szakembert, vagy hirdess és szerezz új ügyfeleket!p
        div

        div class=mb-12
            a href=#feltoltes class=nav-link block group
                img src=httpsraw.githubusercontent.comAtika76szakipiac-2025mainszakipiac-reklam.png 
                     alt=Hirdessen Nálunk! 
                     class=w-full rounded-lg shadow-lg transform group-hoverscale-105 transition-transform duration-300
            a
        div

        div class=bg-white p-6 rounded-lg shadow-sm mb-8
            h2 class=text-2xl font-bold text-center mb-4Böngéssz a hirdetések közötth2
            div class=grid mdgrid-cols-3 gap-4
                input type=text id=search-input placeholder=Keresés szakmára vagy névre... class=mdcol-span-2 w-full border-gray-300 rounded-md
                select id=category-select class=w-full border-gray-300 rounded-md
                    option value=Összes kategóriaoption
                    optionÉpítőiparoption
                    optionVillanyszerelésoption
                    optionGépészetoption
                    optionFestésoption
                    optionLakberendezésoption
                    optionSzámítástechnikaoption
                    optionKertépítés, karbantartásoption
                    optionEgyéboption
                select
            div
        div
        
        div id=hirdetesek-lista class=space-y-6
            div class=flex justify-center py-10
                div class=loaderdiv
            div
        div`;

    container.querySelector('#search-input').addEventListener('input', szuresAlkalmazasa);
    container.querySelector('#category-select').addEventListener('change', szuresAlkalmazasa);
    
    await loadHirdetesek();
}

async function showRolunkPage() {
    document.getElementById('rolunk-page').innerHTML = `div class=bg-white p-8 rounded-lg shadow-smh1 class=text-3xl font-bold mb-6Rólunkh1p class=mb-4 text-gray-700A bSzakiPiac-2025.hub célja, hogy összekösse a szakembereket és a megrendelőket Magyarország egész területén – egyszerűen, gyorsan, megbízhatóan.pul class=space-y-3 my-6li class=flex items-startspan class=text-green-500 mr-2 font-bold✔span Közvetlen elérés Regisztrált szakik, értékelésekkel.lili class=flex items-startspan class=text-green-500 mr-2 font-bold✔span Átlátható, rendezett piactér.lili class=flex items-startspan class=text-green-500 mr-2 font-bold✔span Gyors keresés kategória és kulcsszó alapján.lili class=flex items-startspan class=text-green-500 mr-2 font-bold✔span Ingyenes és fizetős hirdetés csomagok mindenkinek.lili class=flex items-startspan class=text-green-500 mr-2 font-bold✔span Egyszerű hirdetésfeltöltés és ügyfélkapcsolat.liulp class=mb-4 text-gray-700bKüldetésünkb Minőségi munkák, elégedett ügyfelek – támogatjuk a magyar vállalkozókat, és segítünk, hogy mindenki megtalálja a legjobb szakembert bármilyen feladathoz!ph3 class=text-2xl font-bold mt-8 mb-4Miért válassz minketh3ul class=list-disc list-inside space-y-2 text-gray-700liGyors és biztonságos hirdetéskezelésliliEgyszerűen használható felületliliSegítőkész ügyfélszolgalatliliFolyamatos fejlesztés, új funkciókliuldiv`;
}

async function showKapcsolatPage() {
    const container = document.getElementById('kapcsolat-page');
    container.innerHTML = `div class=bg-white p-8 rounded-lg shadow-smh1 class=text-3xl font-bold mb-6Kapcsolath1div class=grid mdgrid-cols-2 gap-12divh3 class=text-xl font-semiboldElérhetőségeinkh3p class=mt-4bE-mailb a href=mailtoszakipiac2025@gmail.com class=text-green-600szakipiac2025@gmail.comapdivdivh3 class=text-xl font-semibold mb-4Írj nekünk!h3form id=kapcsolat-form class=space-y-4divlabel for=kapcsolat-nevNévlabelinput type=text id=kapcsolat-nev required class=mt-1 block w-full border-gray-300 rounded-mddivdivlabel for=kapcsolat-emailE-mail címlabelinput type=email id=kapcsolat-email required class=mt-1 block w-full border-gray-300 rounded-mddivdivlabel for=kapcsolat-uzenetÜzenetlabeltextarea id=kapcsolat-uzenet rows=4 required class=mt-1 block w-full border-gray-300 rounded-mdtextareadivbutton type=submit class=w-full bg-green-600 text-white py-2 rounded-mdÜzenet elküldésebuttonformdivdivdiv`;
    container.querySelector('#kapcsolat-form').addEventListener('submit', (e) = {
        e.preventDefault(); showToast('Köszönjük az üzenetet! (Ez egy demo.)', 'info'); e.target.reset();
    });
}

async function showAuthPage() {
    const container = document.getElementById('auth-page');
    const { data { session } } = await supaClient.auth.getSession();
    if (session) {
        container.innerHTML = `div class=bg-white p-8 rounded-lg shadow-sm text-centerh1 class=text-2xl font-bold mb-4Már be vagy jelentkezve.h1p class=text-gray-600${session.user.email}pdiv`;
        return;
    }
    container.innerHTML = `
        div class=bg-white p-8 rounded-lg shadow-sm max-w-md mx-auto
            h2 id=auth-title class=text-2xl font-bold text-center mb-6Bejelentkezésh2
            form id=auth-form class=space-y-6
                divlabel for=email class=block text-smEmail címlabelinput id=email type=email autocomplete=email required class=mt-1 w-full border-gray-300 rounded-mddiv
                divlabel for=password class=block text-smJelszólabelinput id=password type=password required class=mt-1 w-full border-gray-300 rounded-mddiv
                divbutton id=auth-submit-btn type=submit class=w-full text-white bg-green-600 hoverbg-green-700 py-2 rounded-mdBejelentkezésbuttondiv
            form
            div class=mt-6 text-centera href=# id=switch-auth-mode class=text-sm text-green-600 hovertext-green-500Nincs még fiókod Regisztrálj!adiv
        div`;
    let isLoginMode = true;
    const authForm = container.querySelector('#auth-form');
    authForm.addEventListener('submit', async (e) = {
        e.preventDefault();
        const email = authForm.email.value, password = authForm.password.value;
        try {
            const { error } = isLoginMode  await supaClient.auth.signInWithPassword({ email, password })  await supaClient.auth.signUp({ email, password });
            if (error) throw error;
            showToast(isLoginMode  Sikeres bejelentkezés!  Sikeres regisztráció! Erősítsd meg az emailed.);
            window.location.hash = '#home';
        } catch (error) { showToast(Hiba  + error.message, 'error'); }
    });
    container.querySelector('#switch-auth-mode').addEventListener('click', (e) = {
        e.preventDefault(); isLoginMode = !isLoginMode;
        container.querySelector('#auth-title').textContent = isLoginMode  'Bejelentkezés'  'Regisztráció';
        container.querySelector('#auth-submit-btn').textContent = isLoginMode  'Bejelentkezés'  'Regisztráció';
        e.target.textContent = isLoginMode  'Nincs még fiókod Regisztrálj!'  'Van már fiókod Jelentkezz be!';
    });
}

async function loadHirdetesek() {
    const hirdetesekLista = document.getElementById('hirdetesek-lista');
    try {
        const { data, error } = await supaClient
            .from('hirdetesek')
            .select('')
            .gte('lejárati_datum', new Date().toISOString());

        if (error) throw error;

        const csomagErtekek = { 'extra' 3, 'premium' 2, 'alap' 1 };
        data.sort((a, b) = {
            const ertekA = csomagErtekek[a.csomag]  0;
            const ertekB = csomagErtekek[b.csomag]  0;
            if (ertekA !== ertekB) {
                return ertekB - ertekA;
            }
            return new Date(b.created_at) - new Date(a.created_at);
        });

        hirdetesekCache = data;
        renderHirdetesek(hirdetesekCache);
    } catch (error) {
        if (hirdetesekLista) hirdetesekLista.innerHTML = `p class=text-center text-red-600Hiba a hirdetések betöltésekor.p`;
    }
}


async function renderHirdetesek(hirdetesek) {
    const hirdetesekLista = document.getElementById('hirdetesek-lista');
    if (!hirdetesekLista) return;
    const { data { session } } = await supaClient.auth.getSession();
    if (!hirdetesek  hirdetesek.length === 0) {
        hirdetesekLista.innerHTML = p class='text-center text-gray-500'Jelenleg nincsenek aktív hirdetések. Legyél te az első!p;
        return;
    }
    hirdetesekLista.innerHTML = hirdetesek.map(h = {
        const isOwner = session && session.user.id === h.user_id;
        const isAdmin = session && session.user.email === ADMIN_EMAIL;
        const kepekHTML = h.kep_url_tomb && h.kep_url_tomb.length  0  `div class=flex flex-wrap gap-2 mb-4${h.kep_url_tomb.map(url = `img src=${url} alt=Hirdetés kép class=h-20 w-20 object-cover rounded-md cursor-pointer onclick=openLightbox('${url}')`).join('')}div`  '';
        const deleteButtonHTML = (isOwner  isAdmin)  `button onclick=handleDeleteAd('${h.id}') class=px-3 py-1.5 text-sm text-white bg-red-600 rounded-md hoverbg-red-700Törlésbutton`  '';
        const kiemelesClass = h.csomag === 'extra'  'border-2 border-yellow-400'  '';
        const plecsniHTML = h.csomag === 'extra'  'div class=absolute top-0 right-0 -mt-3 -mr-3 bg-yellow-400 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg z-10EXTRAdiv'  '';

        return `div class=bg-white p-6 rounded-lg shadow-sm relative ${kiemelesClass}
            ${plecsniHTML}
            div class=flex justify-between items-start
                divp class=text-sm font-medium text-green-600${h.kategoria  ''}ph3 class=text-xl font-bold mt-1${h.cim}h3div
                p class=text-lg font-semibold${h.ar  h.ar.toLocaleString('hu-HU') + ' Ft'  'Megegyezés szerint'}p
            div
            p class=text-gray-600 my-4${h.leiras}p${kepekHTML}
            div class=flex flex-wrap gap-2 pt-4 border-t justify-between items-center
                div
                    a href=mailto${h.email} class=px-3 py-1.5 text-sm text-white bg-green-600 rounded-mdKapcsolat (Email)a
                    ${h.telefonszam  `a href=tel${h.telefonszam} class=px-3 py-1.5 text-sm text-gray-700 bg-gray-200 rounded-mdKapcsolat (Telefon)a`  ''}
                    ${h.weboldal  `a href=${h.weboldal} target=_blank rel=noopener nofollow class=px-3 py-1.5 text-sm text-white bg-blue-600 rounded-md hoverbg-blue-700Weboldala`  ''}
                    div${deleteButtonHTML}
            divdiv`;
    }).join('');
}

function szuresAlkalmazasa() {
    const searchText = document.getElementById('search-input').value.toLowerCase();
    const category = document.getElementById('category-select').value;
    const filtered = hirdetesekCache.filter(h = {
        const matchesText = `${h.cim} ${h.leiras}`.toLowerCase().includes(searchText);
        const matchesCategory = !category  h.kategoria === category;
        return matchesText && matchesCategory;
    });
    renderHirdetesek(filtered);
}

async function showFeltoltesPage() {
    const container = document.getElementById('feltoltes-page');
    const { data { session } } = await supaClient.auth.getSession();
    if (!session) {
        container.innerHTML = `div class=bg-white p-8 rounded-lg shadow-sm text-centerh1 class=text-2xl font-bold mb-4A hirdetésfeladáshoz be kell jelentkezned.h1a href=#auth class=text-green-600 hoverunderlineKattints ide.adiv`;
        return;
    }
    kivalasztottKepek = [];
    container.innerHTML = `
        div class=bg-white p-8 rounded-lg shadow-sm
            h1 class=text-3xl font-bold mb-2Hirdetés feltöltéseh1
            p class=text-gray-600 mb-8Töltsd ki az űrlapot, vagy használd az AI segédet!p
            div class=bg-indigo-50 border border-indigo-200 p-6 rounded-lg mb-8
                h2 class=text-xl font-semibold text-indigo-800 mb-3✨ AI Hirdetés Segédh2
                div class=flex flex-col smflex-row gap-2
                    input type=text id=gemini-keywords placeholder=Kulcsszavak, pl. 'szobafestés, Budapest' class=flex-grow w-full px-4 py-2 border-indigo-300 rounded-md
                    button id=generate-ad-btn class=inline-flex items-center justify-center px-4 py-2 text-sm text-white bg-indigo-600 hoverbg-indigo-700 rounded-mdSzöveg generálásabutton
                div
            div
            form id=feltoltesForm class=space-y-6
                divlabel class=block text-smCímlabelinput type=text id=cim required class=mt-1 w-full border-gray-300 rounded-md shadow-smdiv
                divlabel class=block text-smLeíráslabeltextarea id=leiras rows=6 required class=mt-1 w-full border-gray-300 rounded-md shadow-smtextareadiv
                div class=grid mdgrid-cols-2 gap-6
                    divlabel class=block text-smKategórialabelselect id=kategoria required class=mt-1 w-full border-gray-300 rounded-md shadow-smoption value=Válassz...optionoptionÉpítőiparoptionoptionVillanyszerelésoptionoptionGépészetoptionoptionFestésoptionoptionLakberendezésoptionoptionSzámítástechnikaoptionoptionKertépítés, karbantartásoptionoptionEgyéboptionselectdiv
                    divlabel class=block text-smTelefonszám (opcionális)labelinput type=tel id=telefonszam placeholder=+36... class=mt-1 w-full border-gray-300 rounded-md shadow-smdiv
                    div
                        label class=block text-smSaját weboldal (opcionális)label
                        input type=url id=weboldal placeholder=https... class=mt-1 w-full border-gray-300 rounded-md shadow-sm
                    div
                    div
                divlabel class=block text-smÁr (Ft, opcionális)labelinput type=number id=ar min=0 placeholder=Megegyezés szerint class=mt-1 w-full border-gray-300 rounded-md shadow-smdiv
                divlabel class=block text-smCsomaglabelselect id=csomag required class=mt-1 w-full border-gray-300 rounded-md shadow-smoption value=alap_0_2Alap (ingyenes, 2 kép)optionoption value=premium_1990_3Prémium (1990 Ft, 3 kép)optionoption value=extra_2990_5Extra (2990 Ft, 5 kép)optionselectdiv
                div
                    label class=block text-smKépek (span id=max-kepek-szama2span db)label
                    div class=mt-1label for=kep-input class=cursor-pointer text-green-600 hoverunderlineFájlok kiválasztása...input id=kep-input type=file class=sr-only multiple accept=imagelabeldiv
                    div id=kep-elonezetek class=mt-4 grid grid-cols-3 smgrid-cols-5 gap-4div
                div
                div id=payment-section class=border-t pt-6
                    div id=free-submit-section
                        button type=button id=free-submit-btn class=w-full bg-green-600 text-white py-3 rounded-md hoverbg-green-700Hirdetés feladásabutton
                    div
                    div id=paypal-button-container class=hiddendiv
                div
            form
        div`;
    setupFeltoltesListeners();
}

function setupFeltoltesListeners(){const container=document.getElementById('feltoltes-page');container.querySelector('#generate-ad-btn').addEventListener('click',generateAdContent);const csomagSelect=container.querySelector('#csomag'),kepInput=container.querySelector('#kep-input'),freeSubmitBtn=container.querySelector('#free-submit-btn');csomagSelect.addEventListener('change',handleCsomagValtas);kepInput.addEventListener('change',handleKepKivalasztas);if(freeSubmitBtn)freeSubmitBtn.addEventListener('click',(e)={e.preventDefault();processAdSubmission();});handleCsomagValtas()}
async function handleCsomagValtas(){const csomagSelect=document.getElementById('csomag');if(!csomagSelect)return;const[packageName,price,maxKepek]=csomagSelect.value.split('_');document.getElementById('max-kepek-szama').textContent=maxKepek;if(kivalasztottKepek.lengthmaxKepek){kivalasztottKepek=kivalasztottKepek.slice(0,maxKepek);renderKepElonezetek();showToast(`A képek száma a csomagnak megfelelően ${maxKepek} darabra csökkent.`,'info')}
const{data{session}}=await supaClient.auth.getSession(),isAdmin=session&&session.user.email===ADMIN_EMAIL,freeSubmitSection=document.getElementById('free-submit-section'),paypalContainer=document.getElementById('paypal-button-container');if(isAdminprice==0){freeSubmitSection.style.display='block';paypalContainer.style.display='none';paypalContainer.innerHTML=''}else{freeSubmitSection.style.display='none';paypalContainer.style.display='block';paypalContainer.innerHTML='';renderPayPalButton(price,packageName)}}
function handleKepKivalasztas(event){const files=Array.from(event.target.files),maxKepek=parseInt(document.getElementById('max-kepek-szama').textContent);if(kivalasztottKepek.length+files.lengthmaxKepek){showToast(`Maximum ${maxKepek} képet tölthetsz fel.`,'error');event.target.value='';return}
kivalasztottKepek.push(...files);event.target.value='';renderKepElonezetek()}
function renderKepElonezetek(){const previewContainer=document.getElementById('kep-elonezetek');if(!previewContainer)return;previewContainer.innerHTML='';kivalasztottKepek.forEach((file,index)={const reader=new FileReader;reader.onload=e={const previewWrapper=document.createElement('div');previewWrapper.className='relative group aspect-w-1 aspect-h-1';const img=document.createElement('img');img.src=e.target.result;img.className='w-full h-full object-cover rounded-md border-2 border-gray-200';const deleteButton=document.createElement('button');deleteButton.type='button';deleteButton.innerHTML='&times;';deleteButton.className='absolute -top-2 -right-2 bg-red-600 text-white rounded-full h-6 w-6 flex items-center justify-center text-lg font-bold opacity-0 group-hoveropacity-100 transition-opacity focusoutline-none';deleteButton.onclick=()=kepTorlese(index);previewWrapper.appendChild(img);previewWrapper.appendChild(deleteButton);previewContainer.appendChild(previewWrapper)};reader.readAsDataURL(file)})}
function kepTorlese(index){kivalasztottKepek.splice(index,1);renderKepElonezetek()}
async function processAdSubmission(){const adData=getAdData();if(!adData)return;showToast('Feltöltés folyamatban...','info');try{const kepUrlTomb=await uploadKepek(kivalasztottKepek);await saveAdToDatabase(adData,kepUrlTomb)}catch(error){showToast(`Hiba történt ${error.message}`,'error')}}
function getAdData(){const cim=document.getElementById('cim').value,leiras=document.getElementById('leiras').value;if(!cim!leiras){showToast(A Cím és Leírás mezők kitöltése kötelező!,error);return null}
return{cim,leiras,kategoriadocument.getElementById('kategoria').value,ardocument.getElementById('ar').valuenull,telefonszamdocument.getElementById('telefonszam').valuenull,weboldaldocument.getElementById('weboldal').valuenull}}
async function uploadKepek(files){const{data{session}}=await supaClient.auth.getSession();if(!sessionfiles.length===0)return[];const uploadPromises=files.map(file={const fileName=`${session.user.id}${Date.now()}_${file.name}`;return supaClient.storage.from('hirdetes-kepek').upload(fileName,file)}),results=await Promise.all(uploadPromises),urls=[];for(const result of results){if(result.error){console.error('Hiba a kép feltöltésekor',result.error.message);throw new Error('Hiba a kép feltöltésekor.')}
const{data}=supaClient.storage.from('hirdetes-kepek').getPublicUrl(result.data.path);urls.push(data.publicUrl)}
return urls}
async function saveAdToDatabase(adData,kepUrlTomb=[]){const{data{session}}=await supaClient.auth.getSession();if(!session){showToast(Hiba nem vagy bejelentkezve!,error);return}
const csomagNev=document.getElementById('csomag').value.split('_')[0];let napok={'alap'7,'premium'14,'extra'30}[csomagNev]7;const lejaratiDatum=new Date;lejaratiDatum.setDate(lejaratiDatum.getDate()+napok);const{error}=await supaClient.from('hirdetesek').insert({...adData,user_idsession.user.id,emailsession.user.email,csomagcsomagNev,kep_url_tombkepUrlTomb,lejárati_datumlejaratiDatum.toISOString()});if(error){showToast(`Hiba a mentéskor ${error.message}`,'error');console.error(Supabase insert error,error)}else{showToast('Hirdetés sikeresen feladva!','success');window.location.hash='#home'}}
function renderPayPalButton(price,packageName){paypal.Buttons({createOrder(data,actions)={if(!getAdData())return Promise.reject(new Error(Hibás űrlapadatok.));return actions.order.create({purchase_units[{description`SzakiPiac csomag ${packageName}`,amount{currency_code'HUF',valueprice}}]})},onApprove(data,actions)=actions.order.capture().then(async()={await processAdSubmission()}),onErrorerr=showToast('Hiba a PayPal fizetés során.','error')}).render('#paypal-button-container')}

 ITT AZ ÚJ, BIZTONSÁGOS FÜGGVÉNY
async function generateAdContent() {
    const keywords = document.getElementById('gemini-keywords').value;
    if (!keywords.trim()) {
        showToast(Kérlek, adj meg kulcsszavakat!, 'error');
        return;
    }

    const generateBtn = document.getElementById('generate-ad-btn');
    const originalBtnContent = generateBtn.innerHTML;
    generateBtn.disabled = true;
    generateBtn.innerHTML = 'div class=gemini-loaderdivspan class=ml-2Generálás...span';

    try {
         Hívás a saját, biztonságos Supabase Function-höz
        const { data, error } = await supaClient.functions.invoke('generate-ad', {
            body { keywords keywords }
        });

        if (error) {
             Ha a function hibát dob, itt elkapjuk
            throw new Error(error.message  'Ismeretlen hiba a szerveroldali generálás során.');
        }
        
         A function által visszaadott adatok felhasználása
        document.getElementById('cim').value = data.cim;
        document.getElementById('leiras').value = data.leiras;
        showToast(Sikeres generálás!, 'success');

    } catch (error) {
        showToast(Hiba a generálás során  + error.message, 'error');
        console.error(Hiba a Function hívásakor, error);
    } finally {
        generateBtn.disabled = false;
        generateBtn.innerHTML = originalBtnContent;
    }
}

async function handleAuthUI() {
    const { data { session } } = await supaClient.auth.getSession();
    const navAuth = document.getElementById('nav-auth-section');
    const mobileNavAuth = document.getElementById('mobile-nav-auth-section');
    let authHTML = '';
    if (session) {
        const isAdmin = session.user.email === ADMIN_EMAIL;
        authHTML = `div class=flex items-center gap-4span class=text-sm hidden lginline${session.user.email}span${isAdmin  'a href=#admin class=text-sm font-medium text-yellow-600Admina'  ''}button id=logoutBtn class=text-sm font-mediumKijelentkezésbuttondiv`;
    } else {
        authHTML = `a href=#auth class=text-base font-medium text-gray-500 hovertext-gray-900Bejelentkezésa`;
    }
    navAuth.innerHTML = authHTML;
    mobileNavAuth.innerHTML = authHTML.replace('hidden lginline', '');
    if (session) {
        document.querySelectorAll('#logoutBtn').forEach(btn = btn.addEventListener('click', async () = {
            await supaClient.auth.signOut();
            showToast(Sikeres kijelentkezés!);
            window.location.hash = '#home';
        }));
    }
}

function showToast(message, type = 'success') {
    const toast = document.getElementById('toast-notification');
    toast.textContent = message;
    toast.className = `fixed top-5 right-5 text-white py-2 px-4 rounded-lg shadow-lg transform transition-transform duration-300 z-[110] ${type === 'error'  'bg-red-500'  'bg-green-500'}`;
    toast.classList.remove('translate-x-[120%]');
    setTimeout(() = {
        toast.classList.add('translate-x-[120%]');
    }, 4000);
}

window.openLightbox = (imageUrl) = {
    const lightbox = document.getElementById('lightbox');
    document.getElementById('lightbox-img').src = imageUrl;
    lightbox.classList.remove('hidden');
    setTimeout(() = lightbox.classList.remove('opacity-0'), 10);
};

async function handleDeleteAd(adId) {
    if (!confirm('Biztosan törölni szeretnéd ezt a hirdetést Ez a művelet nem vonható vissza.')) {
        return;
    }
    try {
        const { data ad, error selectError } = await supaClient.from('hirdetesek').select('kep_url_tomb,weboldal').eq('id', adId).single();
        if (selectError) throw selectError;

        if (ad.kep_url_tomb && ad.kep_url_tomb.length  0) {
            const filePaths = ad.kep_url_tomb.map(url = new URL(url).pathname.split('hirdetes-kepek')[1]);
            const { error storageError } = await supaClient.storage.from('hirdetes-kepek').remove(filePaths);
            if (storageError) {
                console.error(Hiba a képek törlésekor, de a hirdetést ettől még töröljük, storageError);
            }
        }

        const { error deleteError } = await supaClient.from('hirdetesek').delete().eq('id', adId);
        if (deleteError) throw deleteError;
        showToast('Hirdetés sikeresen törölve.', 'success');
        loadHirdetesek();
    } catch (error) {
        showToast(`Hiba a törlés során ${error.message}`, 'error');
        console.error(Delete ad error, error);
    }
}

async function showAdminPage() {
    const container = document.getElementById('admin-page');
    container.innerHTML = `div class=flex justify-center py-10div class=loaderdivdiv`;
    const { data { session } } = await supaClient.auth.getSession();
    if (!session  session.user.email !== ADMIN_EMAIL) {
        container.innerHTML = `p class=text-red-500 text-centerNincs jogosultságod az oldal megtekintéséhez.p`;
        return;
    }
    try {
        const { data hirdetesek, error } = await supaClient.from('hirdetesek').select('').order('created_at', { ascending false });
        if (error) throw error;

        container.innerHTML = `
            h2 class=text-2xl font-bold mb-4Adminisztráció - Hirdetések kezeléseh2
            div class=bg-white rounded-lg shadow-sm overflow-x-auto
                table class=w-full text-sm text-left
                    thead class=bg-gray-50
                        tr
                            th class=p-4Címth
                            th class=p-4Felhasználóth
                            th class=p-4Lejáratth
                            th class=p-4Műveletekth
                        tr
                    thead
                    tbody
                        ${hirdetesek.map(h = `
                        tr class=border-b
                            td class=p-4${h.cim}td
                            td class=p-4${h.email}td
                            td class=p-4 whitespace-nowrap${h.lejárati_datum  new Date(h.lejárati_datum).toLocaleDateString('hu-HU')  'NA'}td
                            td class=p-4 space-x-2
                                button onclick=handleDeleteAd('${h.id}') class=text-red-600 hoverunderlineTörlésbutton
                            td
                        tr`).join('')}
                    tbody
                table
            div`;
    } catch (err) {
        container.innerHTML = `p class=text-red-500 text-centerHiba a hirdetések betöltésekor ${err.message}p`;
    }
}

document.addEventListener('DOMContentLoaded', () = {
    const lightbox = document.getElementById('lightbox');
    document.getElementById('lightbox-close').addEventListener('click', () = {
        lightbox.classList.add('opacity-0');
        setTimeout(() = lightbox.classList.add('hidden'), 300);
    });
    handleAuthUI();
    handleRouteChange();
    window.addEventListener('hashchange', handleRouteChange);
    document.querySelectorAll('.nav-link, .nav-link-logo').forEach(link = {
        link.addEventListener('click', e = {
            e.preventDefault();
            window.location.hash = new URL(link.href).hash;
        });
    });
    document.getElementById('mobile-menu-button').addEventListener('click', () = {
        document.getElementById('mobile-menu').classList.toggle('hidden');
    });
    supaClient.auth.onAuthStateChange((event, session) = {
        handleAuthUI();
        handleRouteChange();
    });
});
script
body
html