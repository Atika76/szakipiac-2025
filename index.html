<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Hirdetés Segéd — SzakiPiac</title>
  <style>
    :root{--bg:#0f1720;--card:#111827;--accent:#7c3aed;--muted:#9ca3af;--ok:#10b981}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial; margin:0; background:linear-gradient(180deg,#0b1220 0%, #07111a 100%); color:#eef2ff}
    .wrap{max-width:980px;margin:36px auto;padding:24px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{width:56px;height:56px;border-radius:8px;background:linear-gradient(90deg,#f59e0b,#f97316);display:flex;align-items:center;justify-content:center;font-weight:700;color:#081029}
    h1{margin:0;font-size:22px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px}
    .card{background:rgba(255,255,255,0.03);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:8px}
    input[type=text], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:15px;box-sizing:border-box}
    textarea{min-height:120px;resize:vertical}
    .btn{display:inline-block;padding:10px 16px;border-radius:10px;background:var(--accent);color:white;border:0;cursor:pointer;font-weight:600}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px;color:var(--muted);margin-top:8px}
    .ai-box{border-radius:10px;padding:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
    .result{white-space:pre-wrap;background:rgba(0,0,0,0.25);padding:12px;border-radius:8px;margin-top:10px}
    .row{display:flex;gap:10px;align-items:center}
    .fileinput{display:flex;gap:10px;align-items:center}
    .upload-preview{max-width:100%;height:120px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,0.04)}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:920px){.grid{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">SP</div>
      <div>
        <h1>SzakiPiac — AI Hirdetés Segéd</h1>
        <div class="small">Töltsd fel a hirdetést, vagy használd az AI segédet a leírás generálásához.</div>
      </div>
    </header>

    <div class="grid">
      <!-- bal: űrlap -->
      <section class="card">
        <h2 style="margin-top:0">Hirdetés feltöltése</h2>
        <form id="adForm">
          <label for="title">Cím</label>
          <input id="title" type="text" placeholder="Pl. Ablakcsere - gyors szakszerű kivitelezés" required>

          <label for="description" style="margin-top:10px">Leírás</label>
          <textarea id="description" placeholder="Itt jelenik meg az AI által generált szöveg, vagy beírhatod kézzel"></textarea>

          <label style="margin-top:10px">Kép feltöltése</label>
          <div class="fileinput">
            <input id="imageFile" type="file" accept="image/*">
            <button id="uploadBtn" type="button" class="btn secondary">Feltöltés</button>
          </div>
          <img id="preview" class="upload-preview" style="display:none;margin-top:10px" alt="preview">

          <div style="margin-top:14px" class="row">
            <button id="saveAd" type="button" class="btn">Mentés (helyben)</button>
            <button id="publishAd" type="button" class="btn secondary">Közzététel (később)</button>
            <div style="margin-left:auto" class="muted">A feltöltéshez backend / storage szükséges</div>
          </div>

          <div id="formMsg" class="small" style="margin-top:10px"></div>
        </form>
      </section>

      <!-- jobb: AI segéd -->
      <aside>
        <div class="card ai-box">
          <h3 style="margin:0 0 8px 0">✨ AI Hirdetés Segéd</h3>
          <div class="muted">Add meg a szolgáltatást / stílust / kiemelést — az AI segít megfogalmazni a leírást.</div>

          <label style="margin-top:12px">Prompt</label>
          <input id="aiPrompt" type="text" placeholder="Pl. Ablakcserét vállalok Budapest egész területén, gyors kiszállás, garancia.">

          <div style="margin-top:10px" class="row">
            <button id="generateBtn" class="btn">Szöveg generálása</button>
            <button id="copyBtn" class="btn secondary">Másolás a leírásba</button>
          </div>

          <div id="aiStatus" class="small" style="margin-top:10px"></div>

          <label style="margin-top:12px">Generált szöveg</label>
          <textarea id="aiResult" readonly placeholder="Itt jelenik meg a generált szöveg..."></textarea>
        </div>

        <div class="card" style="margin-top:14px">
          <h4 style="margin:0 0 8px 0">Teszt & tippek</h4>
          <ul class="small">
            <li>Ne helyezd a Gemini kulcsot közvetlenül a kliensbe.</li>
            <li>Állítsd be a `/api/generate` végpontot Vercel vagy Supabase Edge Function-ben.</li>
            <li>Ha képet töltesz fel, a backend tárolja a fájlt és visszaad egy publikus URL-t, amit beillesztesz a hirdetésbe.</li>
          </ul>
        </div>
      </aside>

    </div>

    <footer>
      <div>© SzakiPiac — AI Hirdetés Segéd</div>
    </footer>
  </div>

  <script>
    // ----- Kliens JS -----
    // FIGYELEM: a generálást és a feltöltést IDEIGLENESEN / fejlesztésre a következő végpontokhoz kötöttük:
    // - POST /api/generate  -> body: { prompt: "..." }  -> válasz: { text: "..." }
    // - POST /api/upload    -> FormData { file }         -> válasz: { url: "https://..." }
    //
    // Ezeket a végpontokat kell megírnod Vercelen / Supabase Edge Function-ben,
    // ahol a Gemini API kulcsot NEM a kliensben, hanem biztonságosan környezeti változóként tartod.

    const generateBtn = document.getElementById('generateBtn');
    const copyBtn = document.getElementById('copyBtn');
    const aiPrompt = document.getElementById('aiPrompt');
    const aiResult = document.getElementById('aiResult');
    const aiStatus = document.getElementById('aiStatus');

    const uploadBtn = document.getElementById('uploadBtn');
    const imageFile = document.getElementById('imageFile');
    const preview = document.getElementById('preview');
    const formMsg = document.getElementById('formMsg');

    // Generálás - kliens hív egy biztonságos backend végpontot
    generateBtn.addEventListener('click', async () => {
      const prompt = aiPrompt.value.trim();
      if (!prompt) { aiStatus.textContent = 'Írj be valamit a prompt mezőbe.'; return; }

      aiStatus.textContent = 'Generálás...';
      generateBtn.disabled = true;

      try {
        // A te backend-ednek kell kezelnie a Gemini kulcsot és meghívni a generatív API-t.
        const res = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt })
        });

        if (!res.ok) {
          const txt = await res.text();
          throw new Error('Hálózati hiba: ' + res.status + ' ' + txt);
        }

        const data = await res.json();
        // elvárt: { text: "..." } - a backend felelős a Gemini válasz feldolgozásáért
        aiResult.value = data.text ?? JSON.stringify(data, null, 2);
        aiStatus.textContent = 'Kész.';
      } catch (err) {
        console.error(err);
        aiResult.value = '';
        aiStatus.textContent = 'Hiba a generálás során. Nézd meg a konzolt.';
        alert('Hiba a generálás során: ' + err.message);
      } finally {
        generateBtn.disabled = false;
      }
    });

    // Másolás a leírás mezőbe
    copyBtn.addEventListener('click', () => {
      const txt = aiResult.value.trim();
      if (!txt) { alert('Nincs mit másolni.'); return; }
      document.getElementById('description').value = txt;
      alert('A generált szöveg bemásolva a leírás mezőbe.');
    });

    // Kép előnézet
    imageFile.addEventListener('change', (e) => {
      const f = e.target.files[0];
      if (!f) { preview.style.display='none'; preview.src=''; return; }
      const url = URL.createObjectURL(f);
      preview.src = url;
      preview.style.display = 'block';
    });

    // Feltöltés gomb - feltételezzük a /api/upload végpontot
    uploadBtn.addEventListener('click', async () => {
      const f = imageFile.files[0];
      if (!f) { formMsg.textContent = 'Válassz képet előbb!'; return; }
      uploadBtn.disabled = true;
      formMsg.textContent = 'Feltöltés...';

      try {
        const fd = new FormData();
        fd.append('file', f);
        const res = await fetch('/api/upload', { method: 'POST', body: fd });
        if (!res.ok) throw new Error('Upload failed: ' + res.status);
        const data = await res.json(); // { url: 'https://...' }
        formMsg.textContent = 'Feltöltve: ' + (data.url || 'OK');
        // ide beállíthatod automatikusan a description-be vagy elmented
      } catch (err) {
        console.error(err);
        formMsg.textContent = 'Hiba a feltöltésnél.';
        alert('Hiba a feltöltésnél: ' + err.message);
      } finally {
        uploadBtn.disabled = false;
      }
    });

    // Helyi mentés (csak szemléltetés)
    document.getElementById('saveAd').addEventListener('click', () => {
      const ad = {
        title: document.getElementById('title').value,
        description: document.getElementById('description').value,
        // kép URL a backend-től kell, itt csak demo
      };
      // ide: mentés helyileg, vagy POST /api/ads
      localStorage.setItem('draftAd', JSON.stringify(ad));
      alert('Hirdetés lementve (localStorage). Később feltöltheted.');
    });

    // A publish gombot és további funkciókat később kötjük a backend-hez.
  </script>
</body>
</html>
