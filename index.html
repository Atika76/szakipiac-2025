<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SzakiPiac-2025.hu - Találj megbízható szakembert!</title>

  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Atika76/szakipiac-2025/main/logo.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=AQsaQCLj0og2wsfMoDKAqxJieD2cgXwWq5cssAJCJbO2KoYE8LGHCREyR4vMzMfKZK68qw6EY7IAxMYF&currency=HUF"></script>
  <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f7fafc; }
    .page-content { display: none; }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #2d3748; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
    .gemini-loader { border: 2px solid #f3f3f3; border-top: 2px solid #4f46e5; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- ===== Fejléc ===== -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <nav class="container mx-auto px-4 flex justify-between items-center h-16">
      <a href="#home" class="flex items-center gap-2 font-bold text-xl">
        <img src="https://raw.githubusercontent.com/Atika76/szakipiac-2025/main/szakipiac-logo-promo.png" class="h-8" alt="logo">
        SzakiPiac-2025.hu
      </a>
      <div class="hidden md:flex gap-4 items-center">
        <a href="#home" class="hover:text-green-600">Főoldal</a>
        <a href="#rolunk" class="hover:text-green-600">Rólunk</a>
        <a href="#kapcsolat" class="hover:text-green-600">Kapcsolat</a>
        <a href="#feltoltes" class="bg-green-600 text-white px-3 py-2 rounded-md hover:bg-green-700">Hirdetés feltöltése</a>
      </div>
      <div id="nav-auth-section"></div>
    </nav>
  </header>

  <!-- ===== Tartalom ===== -->
  <main class="container mx-auto px-4 py-8">
    <div id="main-loader" class="page-content flex justify-center py-20"><div class="loader"></div></div>
    <div id="home-page" class="page-content"></div>
    <div id="rolunk-page" class="page-content"></div>
    <div id="kapcsolat-page" class="page-content"></div>
    <div id="feltoltes-page" class="page-content"></div>
    <div id="auth-page" class="page-content"></div>
    <div id="admin-page" class="page-content"></div>
  </main>

  <div id="toast-notification" class="fixed top-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg transform translate-x-[120%] transition-transform duration-300 z-[110]"></div>

<script type="module">
  // ===== Supabase =====
  const SUPABASE_URL = "https://bxtpnotswnwrbycvfypz.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ4dHBub3Rzd253cmJ5Y3ZmeXB6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTQ0NDcsImV4cCI6MjA2ODQ5MDQ0N30.CXEfo_8qmIYhkEZFdTsbl9ZB-PRTP6UK8EbIxxpSGZc";
  const supaClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  const ADMIN_EMAIL = "atika.76@windowslive.com";

  // ===== AI hirdetés generálás biztonságosan =====
  async function generateAdContent() {
    const keywords = document.getElementById("gemini-keywords").value;
    const btn = document.getElementById("generate-ad-btn");
    const original = btn.innerHTML;
    if (!keywords.trim()) { showToast("Kérlek, adj meg kulcsszavakat!", "error"); return; }

    btn.disabled = true;
    btn.innerHTML = `<div class="gemini-loader"></div><span class="ml-2">Generálás...</span>`;

    try {
      const response = await fetch("https://bxtpnotswnwrbycvfypz.functions.supabase.co/generate-ad", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: keywords }),
      });

      if (!response.ok) throw new Error("Hiba a szerver oldalon");
      const data = await response.json();
      const generatedAd = data.candidates
        ? JSON.parse(data.candidates[0].content.parts[0].text)
        : data;

      document.getElementById("cim").value = generatedAd.cim;
      document.getElementById("leiras").value = generatedAd.leiras;
      showToast("AI hirdetés sikeresen generálva!", "success");
    } catch (error) {
      console.error("AI generálás hiba:", error);
      showToast("Hiba történt a generálás során. Próbáld újra!", "error");
    } finally {
      btn.disabled = false;
      btn.innerHTML = original;
    }
  }

  // ===== Példa oldal megjelenítés =====
  function showToast(msg, type="success"){
    const toast=document.getElementById("toast-notification");
    toast.textContent=msg;
    toast.className=`fixed top-5 right-5 py-2 px-4 rounded-lg shadow-lg transition-transform duration-300 z-[110] ${type==="error"?"bg-red-500":"bg-green-500"}`;
    toast.classList.remove("translate-x-[120%]");
    setTimeout(()=>toast.classList.add("translate-x-[120%]"),4000);
  }

  function showFeltoltesPage(){
    const container=document.getElementById("feltoltes-page");
    container.innerHTML=`
      <div class="bg-white p-8 rounded-lg shadow-sm">
        <h1 class="text-3xl font-bold mb-2">Hirdetés feltöltése</h1>
        <div class="bg-indigo-50 border p-4 rounded mb-4">
          <h2 class="text-lg font-semibold text-indigo-800 mb-2">✨ AI Hirdetés Segéd</h2>
          <div class="flex gap-2">
            <input id="gemini-keywords" type="text" placeholder="Kulcsszavak..." class="flex-grow border rounded px-2 py-1">
            <button id="generate-ad-btn" class="bg-indigo-600 text-white px-4 py-2 rounded">Szöveg generálása</button>
          </div>
        </div>
        <form class="space-y-4">
          <div><label>Cím</label><input id="cim" class="border rounded w-full"/></div>
          <div><label>Leírás</label><textarea id="leiras" class="border rounded w-full" rows="4"></textarea></div>
        </form>
      </div>
    `;
    document.getElementById("generate-ad-btn").addEventListener("click", generateAdContent);
  }

  function showHomePage(){
    const container=document.getElementById("home-page");
    container.innerHTML=`<h1 class="text-3xl font-bold text-center mb-6">Üdvözlünk a SzakiPiac-2025.hu oldalon!</h1>`;
  }

  const router = {
    '#home': showHomePage,
    '#feltoltes': showFeltoltesPage
  };

  async function handleRouteChange(){
    const hash = window.location.hash || '#home';
    document.querySelectorAll('.page-content').forEach(el=>el.style.display='none');
    await router[hash]?.();
    document.getElementById(hash.substring(1)+'-page').style.display='block';
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    handleRouteChange();
    window.addEventListener("hashchange", handleRouteChange);
  });
</script>
</body>
</html>
