<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SzakiPiac-2025.hu - Tal√°lj megb√≠zhat√≥ szakembert!</title>

    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Atika76/szakipiac-2025/main/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=AQsaQCLj0og2wsfMoDKAqxJieD2cgXwWq5cssAJCJbO2KoYE8LGHCREyR4vMzMfKZK68qw6EY7IAxMYF&currency=HUF"></script>
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7fafc; }
        .page-content { display: none; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #2d3748; width: 40px; height: 40px; border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .lightbox { transition: opacity 0.3s ease; display: flex; align-items: center; justify-content: center; }
        .aspect-w-16 { position: relative; padding-bottom: 56.25%; }
        .aspect-h-9 > iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .bizalmi-pajzs {
            cursor: help;
            margin-left: 8px;
            font-size: 0.9em;
            position: relative;
            display: inline-block;
        }
        .bizalmi-pajzs:before {
            content: attr(data-title);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
            z-index: 50;
            pointer-events: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .bizalmi-pajzs:after {
            content: "";
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
            z-index: 50;
        }
        .bizalmi-pajzs:hover:before,
        .bizalmi-pajzs:hover:after {
            opacity: 1;
            visibility: visible;
            bottom: 135%;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="fixed bottom-4 right-4 z-[60] text-xs bg-white border border-gray-200 px-3 py-2 rounded-full shadow-lg flex gap-2 items-center opacity-90 hover:opacity-100 transition">
        <span class="font-bold text-gray-900">HU</span>
        <span class="text-gray-300">|</span>
        <a href="/En/index.html#home" class="text-gray-500 hover:text-green-600 font-medium">EN</a>
    </div>
    
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center mr-8">
                    <a href="#home" class="nav-link-logo flex-shrink-0 flex items-center gap-2 text-xl font-bold text-gray-800">
                        <img class="h-10 w-auto" src="https://raw.githubusercontent.com/Atika76/szakipiac-2025/main/szakipiac-logo-promo.png" alt="Logo">
                    </a>
                </div>
                
                <div class="hidden md:flex items-center space-x-1 flex-grow justify-end">
                    <a href="#home" class="nav-link text-gray-600 hover:bg-gray-100 px-3 py-2 rounded-md text-sm font-medium">F≈ëoldal</a>
                    <a href="#rolunk" class="nav-link text-gray-600 hover:bg-gray-100 px-3 py-2 rounded-md text-sm font-medium">R√≥lunk</a>
                    <a href="#kapcsolat" class="nav-link text-gray-600 hover:bg-gray-100 px-3 py-2 rounded-md text-sm font-medium">Kapcsolat</a>
                    <a href="kalkulator.html" class="text-orange-600 hover:bg-orange-50 px-3 py-2 rounded-md text-sm font-bold border border-orange-200 flex items-center gap-1 shadow-sm ml-2">
                        <span>üßÆ</span> AI Kalkul√°tor
                    </a>
                    <a href="#feltoltes" class="nav-link bg-green-600 text-white hover:bg-green-700 px-3 py-2 rounded-md text-sm font-medium ml-4">Hirdet√©s felt√∂lt√©se</a>
                </div>
                
                <div id="nav-auth-section" class="hidden md:block ml-6 text-sm"></div>
                
                <div class="md:hidden flex items-center ml-auto">
                    <button id="mobile-menu-button" class="p-2 rounded-md text-gray-600 hover:bg-gray-100 ring-1 ring-gray-300 bg-white">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                    </button>
                </div>
            </div>
            
            <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-gray-100 shadow-xl absolute w-full left-0 z-50">
                <div class="px-4 pt-4 pb-6 space-y-2">
                    <a href="#home" class="nav-link text-gray-700 block px-3 py-3 rounded-md text-base font-medium border-b">üè† F≈ëoldal</a>
                    <a href="#rolunk" class="nav-link text-gray-700 block px-3 py-3 rounded-md text-base font-medium border-b">‚ÑπÔ∏è R√≥lunk</a>
                    <a href="#kapcsolat" class="nav-link text-gray-700 block px-3 py-3 rounded-md text-base font-medium border-b">‚úâÔ∏è Kapcsolat</a>
                    <a href="kalkulator.html" class="text-orange-600 bg-orange-50 block px-3 py-3 rounded-md text-base font-bold border border-orange-200">üßÆ AI √Årkalkul√°tor</a>
                    <a href="#feltoltes" class="nav-link bg-green-600 text-white block px-3 py-3 rounded-md text-base font-medium mt-4 text-center">üì¢ Hirdet√©s felt√∂lt√©se</a>
                    <div id="mobile-nav-auth-section" class="pt-4 mt-4 border-t text-center"></div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen">
        <div id="main-loader" class="page-content flex justify-center items-center py-20" style="display: none;"><div class="loader"></div></div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
                <div id="home-page" class="page-content"></div>
                <div id="rolunk-page" class="page-content"></div>
                <div id="kapcsolat-page" class="page-content"></div>
                <div id="feltoltes-page" class="page-content"></div>
                <div id="auth-page" class="page-content"></div>
                <div id="admin-page" class="page-content"></div>
            </div>
            <aside class="hidden lg:block space-y-6">
              <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100 sticky top-24">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">Partnereink</h3>
                <div id="reklam-slider" class="relative overflow-hidden rounded-lg shadow-md" style="height: 260px;">
                  <a id="reklam-link" href="#" target="_blank" class="block h-full w-full flex items-center justify-center bg-white">
                      <img id="reklam-img" src="" class="max-h-full max-w-full object-contain p-4">
                  </a>
                  <button id="btn-prev" class="absolute top-1/2 left-2 -translate-y-1/2 bg-white/80 p-2 rounded-full shadow hover:bg-white z-10">‚ùÆ</button>
                  <button id="btn-next" class="absolute top-1/2 right-2 -translate-y-1/2 bg-white/80 p-2 rounded-full shadow hover:bg-white z-10">‚ùØ</button>
                </div>
              </div>
            </aside>
        </div>
    </main>
    
    <div id="lightbox" class="fixed inset-0 bg-black/80 z-[100] hidden items-center justify-center opacity-0 lightbox backdrop-blur-sm"><span id="lightbox-close" class="absolute top-4 right-6 text-white text-5xl font-bold cursor-pointer">&times;</span><img id="lightbox-img" class="max-w-[95%] max-h-[90%] rounded-lg"></div>
    <div id="toast-notification" class="fixed top-5 right-5 text-white py-3 px-6 rounded-lg shadow-xl transform translate-x-[120%] transition-transform duration-300 z-[110]"></div>

<script type="module">

// 1. KONFIGUR√ÅCI√ì
const SUPABASE_URL = "https://bxtpnotswnwrbycvfypz.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ4dHBub3Rzd253cmJ5Y3ZmeXB6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTQ0NDcsImV4cCI6MjA2ODQ5MDQ0N30.CXEfo_8qmIYhkEZFdTsbl9ZB-PRTP6UK8EbIxxpSGZc";
const supaClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const ADMIN_EMAIL = "atika.76@windowslive.com";

let kivalasztottKepek = [];
let hirdetesekCache = [];

// 2. SEG√âDF√úGGV√âNYEK
function getYouTubeEmbedUrl(url){if(!url)return null;try{const urlObj=new URL(url);let videoId;if(urlObj.hostname==="youtu.be")videoId=urlObj.pathname.slice(1);else if(urlObj.hostname.includes("youtube.com")&&urlObj.searchParams.has("v"))videoId=urlObj.searchParams.get("v");return videoId?`https://www.youtube.com/embed/${videoId}`:null}catch(e){return null}}

function showToast(message, type="success") {
    const toast = document.getElementById("toast-notification");
    toast.textContent = message;
    toast.className = `fixed top-5 right-5 text-white py-3 px-6 rounded-lg shadow-xl transform transition-transform duration-300 z-[110] ${type==="error"?"bg-red-600":"bg-green-600"}`;
    toast.classList.remove("translate-x-[120%]");
    setTimeout(() => toast.classList.add("translate-x-[120%]"), 4000);
}

// --- √öJ: AUTOMATIKUS T√ñRL√âS A LEJ√ÅRT HIRDET√âSEKHEZ ---
async function cleanupExpiredAds() {
    try {
        const now = new Date().toISOString();
        // T√∂r√∂lj√ºk az √∂sszes olyan sort, ahol a lej√°rati_datum r√©gebbi (kisebb), mint a jelenlegi id≈ë
        const { error } = await supaClient
            .from('hirdetesek')
            .delete()
            .lt('lej√°rati_datum', now);

        if (error) throw error;
        console.log("Lej√°rt hirdet√©sek ellen≈ërizve √©s takar√≠tva.");
    } catch (e) {
        console.error("Hiba az automata takar√≠t√°s sor√°n:", e.message);
    }
}

// 3. REKL√ÅM SLIDER
const reklamok=[
    {url:"#feltoltes",img:"https://raw.githubusercontent.com/Atika76/szakipiac-2025/main/szakipiac-reklam.png"},
    {url:"https://www.alza.hu/",img:"https://upload.wikimedia.org/wikipedia/commons/1/1f/Alza.cz_logo.svg"},
    {url:"https://www.lidl.hu/",img:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Lidl-Logo.svg/1200px-Lidl-Logo.svg.png"}
];
let rIndex=0, rTimer=null;
function renderReklam(){
    const img=document.getElementById("reklam-img"), link=document.getElementById("reklam-link");
    if(!img||!link)return;
    const ad=reklamok[rIndex];
    img.src=ad.img; link.href=ad.url;
    if(!ad.url.startsWith("#")) link.target="_blank";
}
function nextReklam(){ rIndex=(rIndex+1)%reklamok.length; renderReklam(); resetReklamTimer(); }
function prevReklam(){ rIndex=(rIndex-1+reklamok.length)%reklamok.length; renderReklam(); resetReklamTimer(); }
function resetReklamTimer(){ if(rTimer) clearInterval(rTimer); rTimer=setInterval(nextReklam, 4000); }

// 4. ROUTER
const router = { '#home': showHomePage, '#rolunk': showRolunkPage, '#kapcsolat': showKapcsolatPage, '#feltoltes': showFeltoltesPage, '#auth': showAuthPage, '#admin': showAdminPage };

async function handleRouteChange() {
    const hash = window.location.hash || "#home";
    document.querySelectorAll(".page-content").forEach(p => p.style.display = "none");
    const loader = document.getElementById("main-loader");
    if(loader) loader.style.display = "flex";
    try {
        const handler = router[hash] || router['#home'];
        await handler();
        const activePage = document.getElementById(hash.substring(1)+"-page");
        if(activePage) activePage.style.display = "block";
    } catch(e) { console.error(e); }
    if(loader) loader.style.display = "none";
}

// 5. OLDALAK RENDEREL√âSE
async function showHomePage() {
    const c = document.getElementById("home-page");
    c.innerHTML = `
        <div class="text-center mb-8"><h1 class="text-4xl font-bold">√údv√∂zl√ºnk a <span class="text-green-600">SzakiPiac-2025.hu</span>-n!</h1></div>
        <div class="bg-white p-6 rounded shadow mb-8">
            <div class="grid md:grid-cols-3 gap-4">
                <input type="text" id="search" placeholder="Keres√©s..." class="border p-2 rounded">
                <input type="text" id="filter-city" placeholder="V√°ros" class="border p-2 rounded">
                <select id="category-select" class="border p-2 rounded">
                    <option value="">√ñsszes kateg√≥ria</option>
                    <option>K≈ëm≈±ves</option><option>Burkol√≥</option><option>Fest≈ë</option><option>Villanyszerel≈ë</option><option>V√≠z-G√°z-F≈±t√©s</option><option>Egy√©b</option>
                </select>
            </div>
        </div>
        <div id="hirdetes-lista" class="space-y-6"><div class="loader mx-auto"></div></div>`;
    document.getElementById("search").addEventListener("input", filterAds);
    document.getElementById("filter-city").addEventListener("input", filterAds);
    document.getElementById("category-select").addEventListener("change", filterAds);
    await loadAds();
}

async function showRolunkPage(){
    document.getElementById("rolunk-page").innerHTML=`<div class="bg-white p-8 rounded shadow-sm"><h1 class="text-3xl font-bold mb-6 text-green-700">R√≥lunk</h1><p>A SzakiPiac c√©lja a megb√≠zhat√≥ szakemberek √©s a megrendel≈ëk √∂sszekapcsol√°sa.</p></div>`;
}

async function showKapcsolatPage(){
    document.getElementById("kapcsolat-page").innerHTML=`<div class="bg-white p-8 rounded shadow-sm"><h1 class="text-3xl font-bold mb-6 text-green-700">Kapcsolat</h1><p>Email: szakipiac2025@gmail.com</p></div>`;
}

// 6. HIRDET√âS KEZEL√âS
async function loadAds() {
    const listEl = document.getElementById("hirdetes-lista");
    try {
        const {data, error} = await supaClient.from("hirdetesek").select("*").order("created_at", {ascending: false});
        if(error) throw error;
        hirdetesekCache = data;
        renderAds(data);
    } catch(e) { listEl.innerHTML = `<p class="text-red-600">Hiba a bet√∂lt√©skor.</p>`; }
}

function renderAds(list) {
    const listEl = document.getElementById("hirdetes-lista");
    if(!listEl) return;
    supaClient.auth.getSession().then(({data: {session}}) => {
        listEl.innerHTML = list.map(h => {
            const isOwner = session && session.user.id === h.user_id;
            const isAdmin = session && session.user.email === ADMIN_EMAIL;
            const delBtn = (isOwner || isAdmin) ? `<button onclick="window.deleteAd('${h.id}')" class="text-red-600 border border-red-200 px-2 py-1 rounded">T√∂rl√©s</button>` : "";
            const extraBadge = h.csomag === 'extra' ? '<div class="absolute top-0 right-0 bg-yellow-400 text-xs font-bold px-2 py-1 text-white">KIEMELT</div>' : '';
            
            return `
                <div class="bg-white p-6 rounded shadow-sm relative ${h.csomag === 'extra' ? 'border-2 border-yellow-400' : ''}">
                    ${extraBadge}
                    <h3 class="text-xl font-bold">${h.cim} <span class="bizalmi-pajzs" data-title="Ellen≈ërz√∂tt szakember">üõ°Ô∏è</span></h3>
                    <p class="text-gray-600 my-2">${h.leiras}</p>
                    <div class="mt-4 flex justify-between items-center border-t pt-4">
                        <div class="flex gap-2">
                            <a href="mailto:${h.email}" class="bg-green-600 text-white px-3 py-1 rounded text-sm">üìß Email</a>
                            ${h.telefonszam ? `<a href="tel:${h.telefonszam}" class="bg-gray-100 px-3 py-1 rounded text-sm">üìû H√≠v√°s</a>` : ""}
                        </div>
                        ${delBtn}
                    </div>
                </div>`;
        }).join("");
    });
}

function filterAds() {
    const txt = document.getElementById("search").value.toLowerCase();
    const city = document.getElementById("filter-city").value.toLowerCase();
    const cat = document.getElementById("category-select").value;
    const filtered = hirdetesekCache.filter(h => 
        (h.cim + h.leiras).toLowerCase().includes(txt) &&
        (h.varos || "").toLowerCase().includes(city) &&
        (cat === "" || h.kategoria === cat)
    );
    renderAds(filtered);
}

// 7. FELT√ñLT√âS & AUTH
async function showFeltoltesPage() {
    const {data: {session}} = await supaClient.auth.getSession();
    if(!session) { document.getElementById("feltoltes-page").innerHTML = `<div class="p-4 bg-blue-50 text-center rounded">Hirdet√©shez <a href="#auth" class="font-bold underline">l√©pj be!</a></div>`; return; }
    
    document.getElementById("feltoltes-page").innerHTML = `
        <div class="bg-white p-6 rounded shadow">
            <h2 class="text-2xl font-bold mb-4">Hirdet√©s felad√°sa</h2>
            <form id="ad-form" class="space-y-4">
                <input id="cim" placeholder="C√≠m" class="w-full border p-2 rounded" required>
                <textarea id="leiras" placeholder="Le√≠r√°s" class="w-full border p-2 rounded" rows="4" required></textarea>
                <div class="grid md:grid-cols-2 gap-4">
                    <input id="varos" placeholder="V√°ros" class="border p-2 rounded" required>
                    <select id="kategoria" class="border p-2 rounded" required>
                        <option value="">Kateg√≥ria...</option><option>K≈ëm≈±ves</option><option>Fest≈ë</option><option>Egy√©b</option>
                    </select>
                </div>
                <input id="telefonszam" placeholder="Telefonsz√°m" class="w-full border p-2 rounded">
                <select id="csomag" class="w-full border p-2 rounded">
                    <option value="alap">Alap (Ingyen - 7 nap)</option>
                    <option value="premium">Pr√©mium (990 Ft - 14 nap)</option>
                    <option value="extra">Extra (1990 Ft - 30 nap)</option>
                </select>
                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded font-bold">Bek√ºld√©s</button>
            </form>
        </div>`;

    document.getElementById("ad-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const csomag = document.getElementById("csomag").value;
        const days = csomag === 'extra' ? 30 : (csomag === 'premium' ? 14 : 7);
        const lejarat = new Date();
        lejarat.setDate(lejarat.getDate() + days);

        const {error} = await supaClient.from('hirdetesek').insert({
            user_id: session.user.id,
            email: session.user.email,
            cim: document.getElementById("cim").value,
            leiras: document.getElementById("leiras").value,
            varos: document.getElementById("varos").value,
            kategoria: document.getElementById("kategoria").value,
            telefonszam: document.getElementById("telefonszam").value,
            csomag: csomag,
            lej√°rati_datum: lejarat.toISOString()
        });

        if(error) showToast(error.message, "error");
        else { showToast("Sikeres felt√∂lt√©s!"); window.location.hash = "#home"; }
    });
}

async function showAuthPage() {
    document.getElementById("auth-page").innerHTML = `<div class="bg-white p-8 rounded shadow max-w-md mx-auto"><h2 class="text-2xl font-bold mb-4">Bejelentkez√©s</h2><form id="login-form" class="space-y-4"><input type="email" name="email" placeholder="Email" class="w-full border p-2 rounded" required><input type="password" name="password" placeholder="Jelsz√≥" class="w-full border p-2 rounded" required><button class="w-full bg-green-600 text-white p-2 rounded">Mehet</button></form></div>`;
    document.getElementById("login-form").addEventListener("submit", async e => {
        e.preventDefault();
        const {error} = await supaClient.auth.signInWithPassword({email: e.target.email.value, password: e.target.password.value});
        if(error) showToast(error.message, "error"); else { showToast("Bel√©pve!"); window.location.hash = "#home"; window.location.reload(); }
    });
}

// 8. ADMIN PANEL
async function showAdminPage() {
    const {data:{session}} = await supaClient.auth.getSession();
    if(!session || session.user.email !== ADMIN_EMAIL) { document.getElementById("admin-page").innerHTML = "Nincs jogod."; return; }
    const {data} = await supaClient.from("hirdetesek").select("*").order("created_at", {ascending: false});
    document.getElementById("admin-page").innerHTML = `
        <div class="bg-white p-6 rounded shadow overflow-x-auto">
            <h2 class="text-xl font-bold mb-4">Admin Panel (Akt√≠v hirdet√©sek)</h2>
            <table class="w-full text-sm">
                <thead><tr class="bg-gray-100 text-left"><th class="p-2">C√≠m</th><th class="p-2">Lej√°rat</th><th class="p-2">M≈±velet</th></tr></thead>
                <tbody>${data.map(h => `<tr class="border-b"><td class="p-2">${h.cim}</td><td class="p-2">${new Date(h.lej√°rati_datum).toLocaleDateString()}</td><td class="p-2"><button onclick="window.deleteAd('${h.id}')" class="text-red-600">T√∂rl√©s</button></td></tr>`).join("")}</tbody>
            </table>
        </div>`;
}

window.deleteAd = async (id) => {
    if(!confirm("Biztos t√∂rl√∂d?")) return;
    await supaClient.from("hirdetesek").delete().eq("id", id);
    showToast("T√∂r√∂lve");
    handleRouteChange();
};

// 9. IND√çT√ÅS
async function init() {
    // OLDAL BET√ñLT√âSEKOR TAKAR√çTUNK
    await cleanupExpiredAds();

    const {data: {session}} = await supaClient.auth.getSession();
    const navAuth = document.getElementById("nav-auth-section");
    navAuth.innerHTML = session ? `<button onclick="window.doLogout()" class="text-red-600">Kil√©p√©s (${session.user.email})</button>` : `<a href="#auth" class="text-green-600 font-bold">Bel√©p√©s</a>`;

    window.doLogout = async () => { await supaClient.auth.signOut(); window.location.reload(); };
    window.addEventListener("hashchange", handleRouteChange);
    document.getElementById("mobile-menu-button").addEventListener("click", () => document.getElementById("mobile-menu").classList.toggle("hidden"));
    
    handleRouteChange();
    renderReklam();
    resetReklamTimer();
}

init();
</script>
</body>
</html>
